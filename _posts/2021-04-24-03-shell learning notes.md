---
layout: article
date:  2021-04-24  13:50
title: shell脚本学习-基础1
categories: shell
tags: shell
---


## 1. 脚本组成

- 声明解释器:
  #!/bin/bash
- 注释   
  单行注释：#  
  多行注释：
    ```bash
    <<COMMENT
    …
    COMMENT
    ```
    << 后面可以是任意字符串，但前面使用什么关键词，结束注释也必须使用相同的关键词。

## 2. 脚本的执行
- 启动子进程执行脚本：  
bash test.sh  
sh test.sh  
./test.sh  (脚本有执行权限)

- 不启动子进程，在当前进程执行脚本：  
source test.sh  
. test.sh  （注意.后面的空格）


## 3. 脚本输入与输出
-  echo "string"  
echo -e 支持转义字符  
\n 换行  
\033 or \e 色湖之终端属性如字体颜色，背景颜色，定位光标等  
例如：
    ```
    "\033[1mOK\033[0m]"
    \033[1m 表示让终端显示字符串，\033[0m关闭属性设置
    其他属性：
    4m加下划线
    5m闪烁
    30m黑色…
    ```
- printf格式化输出数据
- read输入
  ```
  read 选项 变量名
	选项：
	-p 显示提示信息
	-t 设置读入数据超时时间
	-s slilent，不显示标准输入内容
	-n+number: 近读取n个字符
  ```

## 4. 重定向
- 输出
  
	\> or 1>：标准输出重定向到文件(覆盖)
	2>: 错误输出重定向到文件（覆盖）
	（1/2）>>: 表示追加 
	**如果文件不存在**，**会自动创建文件**
	
	&> or &>>: 标准输出和错误输出都重定向到一个文件
	2>&1: 错误重定向到标准正确输出
	1>&2:标准正确输出重定向到错误输出
	
	将错误输出和标准输出都重定向到文件的另一种方法：
	\> filename 2>&1
	
	特殊文件：
	\> /dev/null 数据一旦导入黑洞将无法找回
    
- 输入：
	<: 使用文件重定向输入
	<<: 将数据内容重定向传递给前面的一个命令，作为命令的输入  
	例如：
    ```
	cat > /tmp/test.txt  << HERE
	该文件未测试文件
	测试完成，记得将文件删除
	HERE
	# 将数据内容传给cat，再通过输出重定向将数据导出到文件的例子。
    ```
	
## 5. 各种引号的使用
“ ”和‘ ’都可以用来引用一个整体，**但是只有单引号可以屏蔽特殊符号**  
\` \`：反引号，命令替换符，将命令的输出结果替代命令  
eg:
>tar -czf /root/log-\`date +%Y%m%d\`.tar.gz /var/log  
echo "当前系统账号登陆数量 \`who | wc -l\` "

## 6. 变量：
- linux中有哪些变量？  
a. 用户自定义变量  
b. 系统预设变量：环境变量，位置变量，预定义变量，自定义变量

一些常见系统预设变量：

| 变量名	| 描述 |
|-|-|
| UID| 当前账户的账户ID  |
|USER|当前账户的账户名称|
| HISTSIZE  |  当前终端的最大历史命令条目数量 |
|HOME|	当前帐户根目录|
|LANG|	当前环境使用语言|
|PATH|	命令搜索路径|
|PWD	|当前工作目录|
|RANDOM|	随即返回0-32767的整数|
|$0|	返回当前命令名称|
|$n|	返回位置参数，如$1第一个位置参数|
|$#|	命令参数个数|
|$*|	命令行的所有参数，所有参数作为一个整体|
|$@|	命令行的所有参数，所有参数作为独立个体|
|$?|	上一条命令退出时状态代码|
|$$|	当前进程的进程号|
|$!|	最后一个后台进程的进程号|


## 7. 数据过滤与正则表达式：

```shell
grep:
-i 忽略大小写
-v 去反匹配
-w 匹配单词
-q 静默匹配
-rn recursive and output line number
```
- 基本正则表达式：

|字符|	含义|
|--|--|
|c|	匹配字母c|
|.|	匹配任意单个字符|
|*|	匹配前一个字符出现零次或多次|
|.*|	匹配多个任意字符|
|[ ]|	匹配集合中的任意单个字符|
|[x-y]|	匹配连续的字符串范围，范围内的任意字符都可以|
|^|	匹配字符串的开头|
|$|	匹配字符串的结尾|
|[^]|	匹配否定，对括号中的集合取反|
|\\ |	匹配转义后的字符|
|\\{n, m\\} |	匹配前一个字符重复n到m次|
|\\{n, \\}|	匹配前一个字符重复至少n次|
|\\(n\\)|	匹配前一个字符重复n次|
|\\( \\)|	将\(与\)之间的内容存储在保留空间，最多可存储9个|
|\\n|	通过\1至\9调用保留空间中的内容|


几种常用用法：
```shell
grep "^$" file	匹配文件的空白行
grep “^#”file	匹配注释行
grep "00*" file	
grep "[0-9]" file	
grep "sbin/[^n]" file	
```
- 扩展正则表达式：

|字符|	含义|
|--|--|
|{n,m}|	等同于基本正则表达式\\{n,m\\}|
|+|	匹配前的字符出现一次或多次|
|?|	匹配前的字符出现零次或一次|
|\||	匹配逻辑或，匹配\|前或后的字符串|
|( )|	匹配正则集合，等同于基本正则表达式的\\(\\)|


必须使用grep -E或者egrep使用

## 8. 算术运算：
一些基本运算符号
> ++， --， +， -， /, %， **（求幂）， &&， \|\|

bash中采用的计算方式如下：
\$( ( ) )  (注意空格), \$[ ]
let：使用变量名时，不需要在变量名前面添加$，默认不会输出运算结果，一般将运算结果赋值给变量
这两种方式只支持整数的四则运算，如果要进行小数的运算需要用到bc计算器


## 参考资料：
《Linux Shell核心编程指南》张明一







